# Architecture Decision Records (ADR)

このディレクトリには、プロジェクトの重要な技術選定とアーキテクチャの決定を記録しています。

## ADR一覧

| # | タイトル | ステータス | 日付 |
|---|---------|-----------|------|
| [001](./001-tanstack-query-for-client-state.md) | TanStack Query採用によるクライアント側データ管理 | 採用 | 2025-11-06 |
| [002](./002-zustand-for-ui-state.md) | Zustand採用によるUI状態管理 | 採用 | 2025-11-06 |
| [003](./003-tanstack-query-vs-swr.md) | TanStack Query vs SWR 比較と選定理由 | 採用 | 2025-11-06 |

## 技術スタックの全体像

```
┌─────────────────────────────────────────────────────────────┐
│                     Next.js App Router                       │
│                                                               │
│  ┌────────────────┐         ┌────────────────┐              │
│  │  Server Side   │         │  Client Side   │              │
│  ├────────────────┤         ├────────────────┤              │
│  │ • fetch        │         │ • TanStack     │              │
│  │   (初期データ)  │         │   Query        │              │
│  │                │         │   (サーバー状態) │              │
│  │ • Server       │         │                │              │
│  │   Actions      │         │ • Zustand      │              │
│  │                │         │   (UI状態)      │              │
│  └────────────────┘         └────────────────┘              │
│                                                               │
│  ┌─────────────────────────────────────────────┐            │
│  │           Form & Validation                  │            │
│  │  • React Hook Form                          │            │
│  │  • Zod                                       │            │
│  └─────────────────────────────────────────────┘            │
│                                                               │
│  ┌─────────────────────────────────────────────┐            │
│  │              Testing                         │            │
│  │  • Vitest (Unit/Integration)                │            │
│  │  • Playwright (E2E)                          │            │
│  └─────────────────────────────────────────────┘            │
└─────────────────────────────────────────────────────────────┘
```

## 状態管理の責務分離

| 状態の種類 | 技術選定 | 用途例 | 代替案（不採用） |
|-----------|---------|--------|----------------|
| **サーバー状態** | TanStack Query | Todos一覧、詳細データ、API通信 | SWR, RTK Query, Apollo Client |
| **UI状態** | Zustand | 検索フォーム表示、モーダル開閉 | Redux Toolkit, Recoil, Jotai, Context API |
| **フォーム状態** | React Hook Form | 入力値、バリデーション | Formik, Final Form, useState |
| **URL状態** | Next.js Router | 検索パラメータ、ページング | - |

## UI状態管理ライブラリの比較

詳細は [ADR 002](./002-zustand-for-ui-state.md) を参照。

| 項目 | Zustand | Redux Toolkit | Recoil | Jotai | Context API |
|------|---------|---------------|--------|-------|-------------|
| **バンドルサイズ** | 1.2 KB | 17.5 KB | 14 KB | 3 KB | 0 KB (内蔵) |
| **学習曲線** | ⭐⭐⭐ 緩やか | ⭐ 急 | ⭐ 急 | ⭐⭐ やや急 | ⭐⭐⭐ 緩やか |
| **ボイラープレート** | ⭐⭐⭐ 少ない | ⭐ 多い | ⭐⭐ やや多い | ⭐⭐ やや多い | ⭐⭐ 中程度 |
| **Provider必要** | ❌ 不要 | ✅ 必要 | ✅ 必要 | △ オプション | ✅ 必要 |
| **DevTools** | ⭐⭐⭐ 簡単 | ⭐⭐⭐ 強力 | ⭐⭐ 可能 | ⭐⭐ やや手間 | ⭐ 難しい |
| **TypeScript** | ⭐⭐⭐ 完全 | ⭐⭐⭐ 完全 | ⭐⭐⭐ 完全 | ⭐⭐⭐ 完全 | ⭐⭐ 手動 |
| **パフォーマンス** | ⭐⭐⭐ 高速 | ⭐⭐⭐ 高速 | ⭐⭐⭐ 高速 | ⭐⭐⭐ 高速 | ⭐⭐ 要最適化 |
| **永続化** | ⭐⭐⭐ 簡単 | ⭐⭐ 可能 | ⭐⭐ 可能 | ⭐⭐ 可能 | ⭐ 手動 |
| **ミドルウェア** | ⭐⭐⭐ 豊富 | ⭐⭐⭐ 豊富 | ⭐⭐ 限定的 | ⭐⭐ 限定的 | ❌ なし |
| **コミュニティ** | ⭐⭐⭐ 大 | ⭐⭐⭐ 最大 | ⭐⭐ 中 | ⭐⭐ 中 | ⭐⭐⭐ React内蔵 |
| **状態管理モデル** | 集中型 | 集中型 | Atom分散型 | Atom分散型 | Context分散型 |
| **Next.js App Router適性** | ⭐⭐⭐ 最適 | ⭐⭐ 可能 | ⭐⭐ 可能 | ⭐⭐⭐ 良好 | ⭐⭐ 可能 |
| **本プロジェクト適性** | ⭐⭐⭐ 最適 | ⭐ オーバースペック | ⭐ オーバースペック | ⭐⭐ やや過剰 | ⭐⭐ シンプル過ぎ |
| **ステータス** | ✅ 採用 | ❌ 却下 | ❌ 却下 | ❌ 却下 | ❌ 却下 |

### プロジェクト規模別推奨

| プロジェクト規模 | 推奨 | 理由 |
|-----------------|------|------|
| **小規模** (1-3人) | **Zustand** | 学習コスト低、ボイラープレート少 |
| **中規模** (3-10人) | **Zustand** | チーム開発に最適、Next.js App Router対応 |
| **大規模** (10-50人) | **Redux Toolkit** / Zustand | ガバナンス重視ならRedux |
| **超大規模** (50+人) | **Redux Toolkit** | 厳格なパターン、監査ログ、複雑なフロー |
| **基幹システム** | **Redux Toolkit** | 金融・医療・官公庁の監査要件対応 |

### 各ライブラリの特徴と却下理由

- **Zustand (採用)**: 1.2KB、Providerなし、学習コスト低、本プロジェクトに最適
- **Redux Toolkit (却下)**: 17.5KB、本アプリにはオーバースペック、大規模・基幹システム向け
- **Recoil (却下)**: v1.0未満、メンテナンス不安定、14KB
- **Jotai (却下)**: Atom分散管理、DevTools統合に手間、本アプリには過剰
- **Context API (却下)**: ボイラープレート多、パフォーマンス要最適化、DevToolsなし

## ADRの読み方

各ADRは以下の構造で記載されています:

- **ステータス**: 採用/却下/検討中/廃止
- **コンテキスト**: なぜこの決定が必要だったか
- **決定事項**: 何を決定したか
- **理由**: なぜこの選択をしたか
- **トレードオフ**: メリット・デメリット
- **代替案**: 検討した他の選択肢と却下理由
- **結果**: 決定による影響

## ADRテンプレート

新しいADRを作成する場合は、以下のテンプレートを使用してください:

```markdown
# ADR XXX: タイトル

## ステータス

[採用/却下/検討中/廃止]

## コンテキスト

[背景と課題]

## 決定事項

[何を決定したか]

## 理由

[なぜこの決定をしたか]

## トレードオフ

### メリット
-

### デメリット
-

## 代替案

### 案1
**却下理由**:

## 結果

[決定による影響]

## 参考資料

-

## 更新履歴

- YYYY-MM-DD: 初版作成
```

## 関連ドキュメント

- [シーケンス図](../todos-page-sequence.md): Todosページのデータフローとシーケンス
- [プロジェクトREADME](../../README.md): プロジェクト全体の説明
